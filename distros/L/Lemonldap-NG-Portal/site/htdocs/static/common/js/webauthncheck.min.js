!function(){var n=function(e,t){return $("#msg").attr("trspan",e),$("#msg").html(window.translate(e)),$("#color").removeClass("message-positive message-warning message-danger alert-success alert-warning alert-danger"),$("#color").addClass("message-"+t),"positive"===t&&(t="success"),$("#color").addClass("alert-"+t)},r=function(){var t,e;if(webauthnJSON.supported())return window.webauthnAbort&&(console.log("Aborting conditional mediation"),window.webauthnAbort.abort()),t=jQuery.Event("webauthnAttempt"),$(document).trigger(t),t.isDefaultPrevented()?void 0:(n("webAuthnBrowserInProgress","warning"),e={publicKey:window.datas.request},webauthnJSON.get(e).then(function(e){if(t=jQuery.Event("webauthnSuccess"),$(document).trigger(t,[e]),!t.isDefaultPrevented())return $("#credential").val(JSON.stringify(e)),$("#credential").closest("form").submit()}).catch(function(e){return t=jQuery.Event("webauthnFailure"),$(document).trigger(t,[e]),t.isDefaultPrevented()||n("webAuthnBrowserFailed","danger"),i()}));n("webAuthnUnsupported","warning")},i=function(){if(PublicKeyCredential.isConditionalMediationAvailable)return PublicKeyCredential.isConditionalMediationAvailable().then(function(e){if(e)return t()})},t=function(){var e;return console.log("Setting up conditional mediation"),window.webauthnAbort=new AbortController,e={publicKey:window.datas.request,mediation:"conditional",signal:window.webauthnAbort.signal},webauthnJSON.get(e).then(function(e){var t=jQuery.Event("webauthnSuccess");if($(document).trigger(t,[e]),!t.isDefaultPrevented())return $("#credential").val(JSON.stringify(e)),$("#credential").closest("form").submit()}).catch(function(e){var t=jQuery.Event("webauthnFailure");if($(document).trigger(t,[e]),!t.isDefaultPrevented())return!0})};$(document).on("portalLoaded",{},function(e,t){return $(document).ready(function(){if($("#retrybutton").on("click",r),$(".webauthnclick").on("click",r),i(),window.datas.webauthn_autostart)return setTimeout(r,1e3)})})}.call(this);