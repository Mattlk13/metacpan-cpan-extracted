(function(){var b=angular.module("llApp",[]);b.provider("$translator",c);function c(){var e={};if(navigator){var g=[navigator.language];if(navigator.languages){g=navigator.languages}var f=[],d=[];g.forEach(function(h){availableLanguages.forEach(function(i){if(i==h){f.push(i)}else{if(i.substring(0,1)==h.substring(0,1)){d.push(i)}}})});e.lang=f[0]?f[0]:d[0]?d[0]:"en"}else{e.lang="en"}e.deferredTr=[];e.translationFields={};e.translate=function(h){if(e.translationFields[h]){h=e.translationFields[h]}return h};e.translateField=function(h,i){return e.translate(h[i])};e.translateP=function(h){if(h&&e.translationFields.portal){h=h.replace(/__(\w+)__/g,function(j,i){return e.translate(i)})}return h};this.$get=["$q","$http",function(h,i){e.last="";e.init=function(k){if(!k){k=e.lang}var j=h.defer();if(e.last!=k){e.last=k;i.get(staticPrefix+"languages/"+k+".json").then(function(l){e.translationFields=l.data;e.deferredTr.forEach(function(m){m.e[m.f](e.translationFields[m.m])});e.deferredTr=[];j.resolve("Translation files loaded")},function(l){j.reject("")})}else{j.resolve("No change")}return j.promise};return e}]}b.directive("trspan",["$translator",function(d){return{restrict:"A",replace:false,transclude:true,scope:{trspan:"@"},link:function(f,g,e){if(d.translationFields.portal){e.trspan=d.translate(e.trspan)}else{d.deferredTr.push({e:g,f:"text",m:e.trspan})}g.text(e.trspan)},template:""}}]);b.provider("$htmlParams",a);function a(){this.$get=function(){var d={};return{set:function(e,f){d[e]=f},menu:function(){return d.menu},params:function(){return d.params}}}}b.directive("script",["$htmlParams",function(d){return{restrict:"E",terminal:true,compile:function(h,f){var g;if(g=f.type.match(/text\/(menu|parameters)/)){try{return d.set(g[1],JSON.parse(h[0].text))}catch(i){console.log("Parsing error:",i);console.log(h[0].text);return}}}}}]);b.controller("ModalInstanceCtrl",["$scope","$uibModalInstance","elem","set","init",function(d,h,g,j,i){var e;d.elem=g;d.set=j;d.result=i;d.staticPrefix=staticPrefix;var f=g("currentNode");d.translateP=g("translateP");if(f){e=f.data;d.currentNode=f}d.ok=function(){j("result",d.result);h.close(true)};d.cancel=function(){if(f){d.currentNode.data=e}h.dismiss("cancel")};d.inSelect=function(l){for(var k=0;k<d.currentNode.select.length;k++){if(d.currentNode.select[k].k==l){return true}}return false}}]);b.directive("onReadFile",["$parse",function(d){return{restrict:"A",scope:false,link:function(h,f,e){var g=d(e.onReadFile);f.on("change",function(j){var i=new FileReader();i.onload=function(k){h.$apply(function(){g(h,{$fileContent:k.target.result})})};i.readAsText((j.srcElement||j.target).files[0])})}}}]);b.directive("resizer",["$document",function(f){var e,d;return function(i,h,g){h.on("mousedown",function(l){if(g.resizer=="vertical"){e=$(g.resizerRight).width()+$(g.resizerLeft).width()}else{d=$(g.resizerTop).height()+$(g.resizerBottom).height()}l.preventDefault();f.on("mousemove",j);f.on("mouseup",k)});function j(m){if(g.resizer=="vertical"){var l=m.pageX;if(g.resizerMax&&l>g.resizerMax){l=parseInt(g.resizerMax)}$(g.resizerLeft).css({width:l+"px"});$(g.resizerRight).css({width:(e-l)+"px"})}else{var n=m.pageY-$("#navbar").height();$(g.resizerTop).css({height:n+"px"});$(g.resizerBottom).css({height:(d-n)+"px"})}}function k(){f.unbind("mousemove",j);f.unbind("mouseup",k)}}}]);b.factory("$lmhttp",["$q","$location",function(d,e){return{responseError:function(f){if(f.status==401&&window.portal){window.location=window.portal+"?url="+window.btoa(window.location).replace(/\//,"_")}else{return d.reject(f)}}}}]);b.config(["$httpProvider",function(d){d.interceptors.push("$lmhttp")}])})();