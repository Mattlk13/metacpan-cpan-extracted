(function(){var u,m,g;g=[function(t){return"groupBy=substr(uid,1)"},function(t){return"uid="+t+"*&groupBy=uid"},function(t){return"uid="+t}],m=function(t,e,n){return console.log("overScheme => level",e,"over",n),1===e&&t.length>n?"uid="+t+"*&groupBy=substr(uid,"+(e+n+1)+")":null},u={actives:[{title:"markAsDone",icon:"check"}],done:[{title:"deleteNotification",icon:"trash"}],new:[{title:"save",icon:"save"}],home:[]},angular.module("llngNotificationsExplorer",["ui.tree","ui.bootstrap","llApp"]).controller("NotificationsExplorerCtrl",["$scope","$translator","$location","$q","$http","$uibModal",function(f,e,t,o,i,r){var d,n,a;return f.links=links,f.menulinks=menulinks,f.staticPrefix=staticPrefix,f.scriptname=scriptname,f.formPrefix=formPrefix,f.availableLanguages=availableLanguages,f.waiting=!0,f.showM=!1,f.showT=!0,f.showForm=!1,f.data=[],f.form={},f.formPost={},f.currentScope=null,f.currentNotification=null,f.menu=u,f.translateP=e.translateP,f.translate=e.translate,f.translateTitle=function(t){return e.translateField(t,"title")},f.menuClick=function(t){if(t.popup)window.open(t.popup);else switch(t.action||(t.action=t.title),typeof t.action){case"function":t.action(f.currentNode,f);break;case"string":f[t.action]();break;default:console.log(typeof t.action)}return f.showM=!1},f.markAsDone=function(){return f.waiting=!0,i.put(scriptname+"notifications/"+f.type+"/"+f.currentNotification.uid+"_"+f.currentNotification.reference,{done:1}).then(function(t){return f.currentNotification=null,f.currentScope.remove(),f.message={title:"notificationDeleted"},f.showModal("alert.html"),f.waiting=!1,f.init()},function(t){return f.message={title:"notificationNotDeleted",message:t.statusText},f.showModal("alert.html"),f.waiting=!1,f.init()})},f.deleteNotification=function(){return f.waiting=!0,i.delete(scriptname+"notifications/"+f.type+"/"+f.currentNotification.uid+"_"+f.currentNotification.reference+"_"+f.currentNotification.done).then(function(t){return f.currentNotification=null,f.currentScope.remove(),f.message={title:"notificationPurged"},f.showModal("alert.html"),f.waiting=!1,f.init()},function(t){return f.message={title:"notificationNotPurged",message:t.statusText},f.showModal("alert.html"),f.waiting=!1,f.init()})},f.stoggle=function(t){var e;return 0===(e=t.$modelValue).nodes.length&&f.updateTree(e.value,e.nodes,e.level,e.over,e.query,e.count),t.toggle()},f.notifDate=function(t){return null!=t?(t.match(/(\d{4})-(\d{2})-(\d{2})/)&&(t=t.substr(0,4)+t.substr(5,2)+t.substr(8,2)),new Date(t.substr(0,4),t.substr(4,2)-1,t.substr(6,2)).toLocaleDateString()):""},f.getLanguage=function(t){return f.lang=t,f.form="white",f.init(),f.showM=!1},f.$on("$locationChangeSuccess",function(t,e,n){var i;return i=e.match(/#!?\/(\w+)/),f.type=null!=i?i[1]:"actives","new"===f.type?f.displayCreateForm():(f.showForm=!1,f.init())}),d=0,f.updateTree=function(a,u,c,s,t,e){var l,n;return f.waiting=!0,l=g[c](a,t),25<e&&(n=m(a,c,s))?(s++,l=n,c-=1):s=0,i.get(scriptname+"notifications/"+f.type+"?"+l).then(function(t){var e,n,i,o,r;if((e=t.data).result){for(n=0,i=(r=e.values).length;n<i;n++)o=r[n],d++,o.id="node"+d,c<g.length-1&&(o.nodes=[],o.level=c+1,o.query=l,o.over=s),u.push(o);""===a&&(f.total=e.total)}return f.waiting=!1},function(t){return f.waiting=!1})},f.displayNotification=function(t){var e,n;return f.waiting=!0,f.currentScope=t,n=(e=t.$modelValue).notification,"actives"===f.type&&(n=e.uid+"_"+e.reference),i.get(scriptname+"notifications/"+f.type+"/"+n).then(function(t){return f.currentNotification={uid:e.uid,reference:e.reference,condition:e.condition},"actives"===f.type?f.currentNotification.notifications=t.data.notifications:f.currentNotification.done=t.data.done,f.waiting=!1},function(t){return f.waiting=!1}),f.showT=!1},f.showModal=function(t,e){var n,i;return i=r.open({templateUrl:t,controller:"ModalInstanceCtrl",size:"lg",resolve:{elem:function(){return function(t){return f[t]}},set:function(){return function(t,e){return f[t]=e}},init:function(){return e}}}),n=o.defer(),i.result.then(function(t){return f.message={title:"",message:""},n.resolve(t)},function(t){return f.message={title:"",message:""},n.reject(t)})},f.save=function(){return f.form.uid&&f.form.reference&&f.form.xml?(f.waiting=!0,f.formPost.uid=f.form.uid,f.form.date&&(f.formPost.date=a(f.form.date)),f.formPost.reference=f.form.reference,f.formPost.condition=f.form.condition,f.formPost.xml=f.form.xml,i.post("notifications/actives",f.formPost).then(function(t){var e;return e=t.data,f.form={},1===e.result?f.message={title:"notificationCreated"}:f.message={title:"notificationNotCreated",message:e.error},f.showModal("alert.html"),f.waiting=!1},function(t){return f.message={title:"notificationNotCreated",message:t.statusText},f.showModal("alert.html"),f.waiting=!1})):(f.message={title:"incompleteForm"},f.showModal("alert.html"))},f.init=function(){return f.waiting=!0,f.showM=!1,f.showT=!1,f.data=[],f.currentScope=null,f.currentNotification=null,o.all([e.init(f.lang),f.updateTree("",f.data,0,0)]).then(function(){return f.waiting=!1},function(t){return f.waiting=!1}),f.activeModule="notifications",f.myStyle={color:"#ffb84d"}},f.displayCreateForm=function(){return f.waiting=!0,e.init(f.lang).then(function(){return f.currentNotification=null,f.showForm=!0,f.data=[],f.waiting=!1,f.form.date=new Date})},n=t.path().match(/^\/(\w+)/),f.type=n?n[1]:"actives",f.popupopen=function(){return f.popup.opened=!0},f.dateOptions={startingDay:1,minDate:new Date},f.popup={opened:!1},a=function(t){var e,n,i;return i=t.getFullYear(),(n=t.getMonth()+1)<10&&(n="0"+n),(e=t.getDate())<10&&(e="0"+e),i+"-"+n+"-"+e}}])}).call(this);