(function(){var U,s,f,h;h={_whatToTrace:[function(e,t){return"groupBy=substr("+e+",1)"},function(e,t){return e+"="+t+"*&groupBy="+e},function(e,t){return e+"="+t}],ipAddr:[function(e,t){return"groupBy=net("+e+",16,1)"},function(e,t){return t.match(/:/)||(t+="."),e+"="+t+"*&groupBy=net("+e+",32,2)"},function(e,t){return t.match(/:/)||(t+="."),e+"="+t+"*&groupBy=net("+e+",48,3)"},function(e,t){return t.match(/:/)||(t+="."),e+"="+t+"*&groupBy=net("+e+",128,4)"},function(e,t){return e+"="+t+"&groupBy=_whatToTrace"},function(e,t,n){return n.replace(/\&groupBy.*$/,"")+"&_whatToTrace="+t}],_startTime:[function(e,t){return"groupBy=substr("+e+",8)"},function(e,t){return e+"="+t+"*&groupBy=substr("+e+",10)"},function(e,t){return e+"="+t+"*&groupBy=substr("+e+",11)"},function(e,t){return e+"="+t+"*&groupBy=substr("+e+",12)"},function(e,t){return e+"="+t+"*&groupBy=_whatToTrace"},function(e,t,n){return console.log(e),console.log(t),console.log(n),n.replace(/\&groupBy.*$/,"")+"&_whatToTrace="+t}],doubleIp:[function(e,t){return e},function(e,t){return"_whatToTrace="+t+"&groupBy=ipAddr"},function(e,t,n){return n.replace(/\&groupBy.*$/,"")+"&ipAddr="+t}],_session_uid:[function(e,t){return"groupBy=substr("+e+",1)"},function(e,t){return e+"="+t+"*&groupBy="+e},function(e,t){return e+"="+t}]},f={_whatToTrace:function(e,t,n,o){return console.log("overScheme => level",n,"over",o),1===n&&t.length>o?e+"="+t+"*&groupBy=substr("+e+","+(n+o+1)+")":null},ipAddr:function(e,t,n,o){return console.log("overScheme => level",n,"over",o),0<n&&n<4&&!t.match(/^\d+\.\d/)&&o<2?e+"="+t+"*&groupBy=net("+e+","+(16*n+4*(o+1))+","+(1+n+o)+")":null},_startTime:function(e,t,n,o){return console.log("overScheme => level",n,"over",o),3<n?e+"="+t+"*&groupBy=substr("+e+","+(10+n+o)+")":null},_session_uid:function(e,t,n,o){return console.log("overScheme => level",n,"over",o),1===n&&t.length>o?e+"="+t+"*&groupBy=substr("+e+","+(n+o+1)+")":null}},U={dateTitle:["_utime","_startTime","_updateTime","_lastAuthnUTime","_lastSeen"],connectionTitle:["ipAddr","_timezone","_url"],authenticationTitle:["_session_id","_user","_password","authenticationLevel"],modulesTitle:["_auth","_userDB","_passwordDB","_issuerDB","_authChoice","_authMulti","_userDBMulti"],saml:["_idp","_idpConfKey","_samlToken","_lassoSessionDump","_lassoIdentityDump"],groups:["groups","hGroups"],ldap:["dn"],BrowserID:["_browserIdAnswer","_browserIdAnswerRaw"],OpenIDConnect:["_oidc_id_token","_oidc_OP","_oidc_access_token"],sfaTitle:["_2fDevices"],oidcConsents:["_oidcConsents"]},s={session:[{title:"deleteSession",icon:"trash"}],home:[]},angular.module("llngSessionsExplorer",["ui.tree","ui.bootstrap","llApp"]).controller("SessionsExplorerCtrl",["$scope","$translator","$location","$q","$http",function(M,t,i,e,o){var d,n,r,g;return M.links=links,M.menulinks=menulinks,M.staticPrefix=staticPrefix,M.scriptname=scriptname,M.formPrefix=formPrefix,M.impPrefix=impPrefix,M.sessionTTL=sessionTTL,M.availableLanguages=availableLanguages,M.waiting=!0,M.showM=!1,M.showT=!0,M.data=[],M.currentScope=null,M.currentSession=null,M.menu=s,M.translateP=t.translateP,M.translate=t.translate,M.translateTitle=function(e){return t.translateField(e,"title")},g="global",M.menuClick=function(e){if(e.popup)window.open(e.popup);else switch(e.action||(e.action=e.title),typeof e.action){case"function":e.action(M.currentNode,M);break;case"string":M[e.action]();break;default:console.log(typeof e.action)}return M.showM=!1},M.deleteOIDCConsent=function(e,t){return angular.element(".data-"+t).remove(),M.waiting=!0,o.delete(scriptname+"sessions/OIDCConsent/"+g+"/"+M.currentSession.id+"?rp="+e+"&epoch="+t).then(function(e){return M.waiting=!1},function(e){return M.waiting=!1}),M.showT=!1},M.deleteSession=function(){return M.waiting=!0,o.delete(scriptname+"sessions/"+g+"/"+M.currentSession.id).then(function(e){return M.currentSession=null,M.currentScope.remove(),M.waiting=!1},function(e){return M.currentSession=null,M.currentScope.remove(),M.waiting=!1})},M.stoggle=function(e){var t;return 0===(t=e.$modelValue).nodes.length&&M.updateTree(t.value,t.nodes,t.level,t.over,t.query,t.count),e.toggle()},M.displaySession=function(e){var t,n;return n=function(s){var e,t,n,o,r,i,l,u,a,c,p,d,g,f,h,_,m,y,T,w,v,S,$,B,b,D,L,A,P,x,C,I,k,O,R,E,H;for(g in e=function(e,t){var n,o,r,i;for(n in r=[],o=new RegExp(e),s)i=s[n],n.match(o)&&i&&(r.push({title:n,value:i}),delete s[n]);if(0<r.length)return P.push({title:t,nodes:r})},O=s._utime,c=s._session_id,s)(H=s[g])?("string"==typeof s&&H.match(/; /)&&(s[g]=H.split("; ")),"object"!=typeof s[g]&&("_password".match(new RegExp("\b"+g+"\b"))?s[g]="********":g.match(/^(_utime|_lastAuthnUTime|_lastSeen|notification)$/)?s[g]=M.localeDate(H):g.match(/^(_startTime|_updateTime)$/)&&(s[g]=M.strToLocaleDate(H)))):delete s[g];for(r in P=[],U){for(I=[],a=0,h=(o=U[r]).length;a<h;a++)if(n=o[a],s[n])if(s[n].toString().match(/"type":\s*"(?:TOTP|U2F|UBK)"/)){for(I.push({title:"type",value:"name",epoch:"date",td:"0"}),p=0,_=(t=JSON.parse(s[n])).length;p<_;p++){for(g in x=t[p])H=x[g],"type"===g&&(R=H),"name"===g&&(S=H),"epoch"===g&&(u=H);I.push({title:R,value:S,epoch:u,td:"1"})}delete s[n]}else if(s[n].toString().match(/"rp":\s*"[\w-]+"/)){for(I.push({title:"rp",value:"scope",epoch:"date",td:"0"}),d=0,m=(t=JSON.parse(s[n])).length;d<m;d++){for(g in B=t[d])H=B[g],"rp"===g&&(R=H),"scope"===g&&(S=H),"epoch"===g&&(u=H);I.push({title:R,value:S,epoch:u,td:"2"})}delete s[n]}else s[n].toString().match(/\w+/)&&I.push({title:n,value:s[n],epoch:""}),delete s[n];else delete s[n];0<I.length&&P.push({title:"__"+r+"__",nodes:I})}if(e("^openid","OpenID"),e("^notification_(.+)","__notificationsDone__"),s._loginHistory){if(E=[],s._loginHistory.successLogin)for(v=0,y=(L=s._loginHistory.successLogin).length;v<y;v++){for(g in i="",f=L[v])H=f[g],g.match(/^(_utime|ipAddr|error)$/)||(i+=", "+g+" : "+H);(k=i.split(", ")).sort(),i=k.join(", "),E.push({t:f._utime,title:M.localeDate(f._utime),value:"Success (IP "+f.ipAddr+")"+i})}if(s._loginHistory.failedLogin)for($=0,T=(A=s._loginHistory.failedLogin).length;$<T;$++){for(g in i="",f=A[$])H=f[g],g.match(/^(_utime|ipAddr|error)$/)||(i+=", "+g+" : "+H);(k=i.split(", ")).sort(),i=k.join(", "),E.push({t:f._utime,title:M.localeDate(f._utime),value:"Error "+f.error+" (IP "+f.ipAddr+")"+i})}delete s._loginHistory,E.sort(function(e,t){return t.t-e.t}),P.push({title:"__loginHistory__",nodes:E})}for(g in E=[],s)H=s[g],E.push({title:g,value:H});for(E.sort(function(e,t){return e.title>t.title?1:e.title<t.title?-1:0}),D=[],C=[],b=0,w=E.length;b<w;b++)(l=E[b]).title.match(new RegExp("^"+M.impPrefix+".+$"))?(console.log(l,"-> real attribute"),D.push(l)):C.push(l);return E=C.concat(D),P.push({title:"__attributesAndMacros__",nodes:E}),{_utime:O,id:c,nodes:P}},t=(M.currentScope=e).$modelValue.session,o.get(scriptname+"sessions/"+g+"/"+t).then(function(e){return M.currentSession=n(e.data)}),M.showT=!1},M.localeDate=function(e){return new Date(1e3*e).toLocaleString()},M.isValid=function(e,t){var n,o,r;return r=i.path(),o=Date.now()/1e3,console.log("Path",r),console.log("Session epoch",e),console.log("Current date",o),console.log("Session TTL",sessionTTL),n=o-e<sessionTTL||i.path().match(/^\/persistent/),"msg"===t?(console.log("Return msg"),n?"info":"warning"):"style"===t?(console.log("Return style"),n?{}:{color:"#627990","font-style":"italic"}):(console.log("Return isValid"),n)},M.strToLocaleDate=function(e){var t;return(t=e.match(/^(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})$/)).length?new Date(t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]).toLocaleString():e},M.getLanguage=function(e){return M.lang=e,M.form="white",M.init(),M.showM=!1},r=function(e,t,n){var o;return o=t.match(/#!?\/(\w+)/),g="global",null===o?M.type="_whatToTrace":o[1].match(/^(persistent|offline)$/)?(g=RegExp.$1,M.type="_session_uid"):M.type=o[1],M.init()},M.$on("$locationChangeSuccess",r),d=0,M.updateTree=function(s,l,u,a,e,t){var c,p,n;if(M.waiting=!0,p=h[M.type]?h[M.type]:"_updateTime"===M.type?h._startTime:h._whatToTrace,c=p[u](M.type,s,e),25<t&&f[M.type]&&(n=f[M.type](M.type,s,u,a,e))?(a++,c=n,u-=1):a=0,o.get(scriptname+"sessions/"+g+"?"+c).then(function(e){var t,n,o,r,i;if((t=e.data).result){for(n=0,o=(i=t.values).length;n<o;n++)r=i[n],d++,r.id="node"+d,u<p.length-1&&(r.nodes=[],r.level=u+1,r.query=c,r.over=a,M.type.match(/^(?:start|update)Time$/)&&(r.title=r.value.replace(/^(\d{8})(\d{2})(\d{2})$/,"$2:$3").replace(/^(\d{8})(\d{2})(\d)$/,"$2:$30").replace(/^(\d{8})(\d{2})$/,"$2h").replace(/^(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"))),l.push(r);""===s&&(M.total=t.total)}return M.waiting=!1},function(e){return M.waiting=!1}),console.log("Selection",g),M.navssoStyle={color:"#777"},M.offlineStyle={color:"#777"},M.persistentStyle={color:"#777"},"global"===g&&(M.navssoStyle={color:"#333"}),"offline"===g&&(M.offlineStyle={color:"#333"}),"persistent"===g)return M.persistentStyle={color:"#333"}},M.init=function(){return M.waiting=!0,M.data=[],M.currentScope=null,M.currentSession=null,e.all([t.init(M.lang),M.updateTree("",M.data,0,0)]).then(function(){return M.waiting=!1},function(e){return M.waiting=!1}),M.activeModule="sessions",M.myStyle={color:"#ffb84d"}},n=i.path().match(/^\/(\w+)/),M.type=n?n[1]:"_whatToTrace"}])}).call(this);